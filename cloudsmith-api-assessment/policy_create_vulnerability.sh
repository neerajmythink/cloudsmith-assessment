#!/usr/bin/env bash

# Create a Vulnerability policy for existing namespace
export NAMESPACE="cloudsmith-org-neeraj" # Replace with your actual namespace
export API_KEY=$CLOUDSMITH_API_KEY # Ensure you have set the CLOUDSMITH_API_KEY environment variable with your API key

# Function to create a Vulnerability policy for an namespace
create_vulnerability_policy() {
  curl -sS\
     --request POST \
     --url https://api.cloudsmith.io/orgs/${NAMESPACE}/vulnerability-policy/ \
     --header "X-Api-Key: ${API_KEY}" \
     --header 'accept: application/json' \
     --header 'content-type: application/json' \
     --data '
            {
              "min_severity": "Medium",
              "allow_unknown_severity": false,
              "description": "This is a vulnerability policy to quarantine packages with vulnerabilities of severity Medium and above.",
              "name": "Quarantine Medium and Above Vulnerabilities",
              "on_violation_quarantine": true
            }
            ' | jq

}

echo "#### Creating a vulnerability policy for namespace: '${NAMESPACE}' with name as 'hhhh' ####"
create_vulnerability_policy