#!/usr/bin/env bash

# Lists policy scan results for a specific repository in given namespace
export NAMESPACE="cloudsmith-org-neeraj" # Replace with your actual namespace
export REPO_NAME="assessment-repo" # You can change the repository name as needed
export API_KEY=$CLOUDSMITH_API_KEY # Ensure you have set the CLOUDSMITH_API_KEY environment variable with your API key

# Function to list policy scan results for a specific repository
list_policy_scan_results() {
  curl -sS\
    --request GET \
    --url https://api.cloudsmith.io/vulnerabilities/${NAMESPACE}/${REPO_NAME} \
    --header "X-Api-Key: ${API_KEY}" \
    --header 'accept: application/json' \
    | jq

}

echo "#### Listing policy scan results for repository: ${REPO_NAME} in namespace: ${NAMESPACE} with the following details:"
list_policy_scan_results